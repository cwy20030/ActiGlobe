% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CosinorM.R
\name{CosinorM}
\alias{CosinorM}
\title{`Cosinor` Model}
\usage{
CosinorM(time, activity, tau, method = "OLS", type = "HC3")
}
\arguments{
\item{time}{Numeric vector of time coordinates for each data point.}

\item{activity}{Numeric vector of activity counts from an actigraphy device.}

\item{tau}{Numeric scalar or vector for the assumed circadian period. Default is 24 for single-phase; multiple phases can be supplied via [c()].}

\item{method}{Character string specifying estimation method:
`OLS`: Ordinary least squares via `stats::lm()`. (default)
`FGLS`: Feasible generalized least squares (Harvey 1976), which models heteroskedasticity via a log-variance fit to squared OLS residuals, computes weights, and refits by weighted least squares.
If an unrecognized value is supplied, an error is returned.}

\item{type}{Character string passed to [sandwich::vcovHC()] for robust standard error computation.}
}
\value{
A list of class `c("CosinorM", "lm")` containing:
- `tau`: The assumed period length
- `time`: The time coordiantes of the recording.
- `method`: The estimation method used.
- `coef.cosinor`: `MESOR`, amplitude, and `acrophase` estimates.
- `vcov`: Robust variance-covariance matrix.
- `se`: Standard errors.
Inherits all components from stats::lm.
}
\description{
`Cosinor` Model
}
\details{
The `Cosinor` model is a cosine-based harmonic regression used to estimate circadian rhythm parameters.
}
\section{Single-phase equation}{

y = M + A * cos(2π * t / τ + φ)

- M: MESOR (mid-line estimating statistic of rhythm), the intercept.
- A: Amplitude, peak deviation from M.
- t: Time coordinate within the cycle.
- τ: The assumed period length.
- φ: Acrophase (time-of-peak), computed from fitted sine and cosine coefficients.
}

\section{Linearized form}{

y_hat = M + β * x + γ * z + ε

- β = A * cos(φ), the estimated coefficients for the cosine function.
- x = cos(2π * t / τ)
- γ = -A * sin(φ), the estimated coefficients for the sine function.
- z = sin(2π * t / τ)
- ε = error term

Model parameters are estimated by minimizing the residual sum of squares:
RSS = sum[ y - (M + β * x + γ * z) ]^2.
By default, [stats::lm()] achieve this through QR decomposition, instead of the typical single vector decomposition technique.
}

\section{Acrophase interpretation}{

φ is derived from atan2(-γ, β) and converted to clock time to identify the peak activity time.
}

\section{Amplitude estimation}{

Amplitude (A) is calculated from the fitted sine and cosine coefficients
obtained in the linearized model. Specifically:
A = sqrt(β^2 + γ^2)

This formula comes directly from the relationship between the linearized
parameters and the polar representation of the cosine wave.
}

\examples{
#' require(stats)
require(graphics)


\dontrun{
# Import data
FlyEast

BdfList =
BriefSum(df = FlyEast ,
         SR = 1/60,
         Start = "2017-10-24 13:45:00")

# Let's extract actigraphy data from a single day
df <- BdfList$df
df <- subset(df, df$Date == "2017-10-27")

fit <- CosinorM(time = df$Time,
                activity = df$Activity,
                tau = 24,
                method = "OLS")


# inspect coefficients
fit$coef.cosinor


# plot KDE in hours
plot(fit$time, fit$fitted.values, type = "l", xlab = "Hour", ylab = "KDE")
}
}
\references{
Chambers, J. M. (1992) Linear models. Chapter 4 of Statistical Models in S eds J. M. Chambers and T. J. Hastie, Wadsworth & Brooks/Cole.

Wilkinson, G. N. and Rogers, C. E. (1973). Symbolic descriptions of factorial models for analysis of variance. Applied Statistics, 22, 392–399. doi:10.2307/2346786.

Harvey, A. C. (1976). Estimating Regression Models with Multiplicative Heteroscedasticity. Econometrica, 44(3), 461–465. doi:10.2307/1913974
}
\seealso{
[stats::lm()] for general linear model.

`CosinorM.KD` for Gaussian.
}
\keyword{`cosinor`}
