% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CosinorM.R
\name{CosinorM}
\alias{CosinorM}
\title{`Cosinor` Model}
\usage{
CosinorM(
  time,
  activity,
  tau,
  method = "OLS",
  arctan2 = TRUE,
  type = "HC3",
  dilute = FALSE
)
}
\arguments{
\item{time}{Numeric vector of time coordinates for each data point}

\item{activity}{Numeric vector of activity counts from an actigraphy device}

\item{tau}{Numeric scalar or vector for the assumed circadian period. Default is 24 for single-phase; multiple phases can be supplied via [c()]}

\item{method}{Character string specifying estimation method
\itemize{
  \item "OLS": Ordinary least squares via \code{\link[stats]{lm}} (default)
  \item "FGLS": Feasible generalized least squares; models heteroskedasticity via a log-variance fit to squared OLS residuals, computes weights, and refits by weighted least squares
}}

\item{arctan2}{Logical; if TRUE (default) acrophase is computed with
\code{atan2(gamma, beta)}, resulting in the quadrant interval between
\eqn{-\pi} and \eqn{\pi}. Whereas, when set to FALSE, the legacy arctangent
quadrant is mapped. The resulting interval lies between \eqn{-\frac{\pi}{2}}
and \eqn{\frac{\pi}{2}}.}

\item{type}{Character string passed to \code{\link[sandwich]{vcovHC}} for robust standard error computation}

\item{dilute}{Logical;
\itemize{
  \item "FALSE": All essential parameters would be produced.  (default)
  \item "TRUE": Only cosinor coefficients are returned. This is suited for post-hoc processes, such as computing confidence interval via nonparametric bootstrap
}}
}
\value{
A list of class c("CosinorM", "lm") containing:
\itemize{
  \item parm: Parameters specified in the model
  \item tau: The assumed period length
  \item time: The time coordinates of the recording
  \item method: The estimation method used
  \item coef.cosinor: Named numeric vector with entries:
    \itemize{
      \item MESOR: Mid-line estimating statistic of rhythm
      \item Amplitude: Predicted peak activity magnitude
      \item Acrophase: Acrophase in radian (time-of-peak)
      \item Beta: the coefficient of the cosine function
      \item Gamma: the coefficient of the sine function
    }
  \item post.hoc: Post-hoc peak/trough diagnostics derived from fitted.values at observation angles (MESOR.ph, Bathyphase.ph.time, Trough.ph, Acrophase.ph.time, Peak.ph, Amplitude.ph)
  \item extra: only available for ultradian (i.e., \eqn{\tau} less than 24hour) single-component model
  \item vcov: Robust variance-covariance matrix
  \item se: Standard errors
}
Inherits all components from \code{\link[stats]{lm}}.
}
\description{
Fit a cosine-based harmonic linear regression on circular time (hours of day)
}
\details{
The `Cosinor` model is a cosine-based harmonic regression used to estimate circadian rhythm parameters.

\strong{Single-phase equation}:
      \deqn{y = M + A \cos \left(\frac{2\pi t}{\tau} - \phi\right) }
\itemize{
  \item \eqn{M }: MESOR (mid-line estimating statistic of rhythm), the intercept
  \item \eqn{A }: Amplitude, peak deviation from M
  \item \eqn{t }: Time coordinate within the cycle
  \item \eqn{\tau }: The assumed period length
  \item \eqn{\phi }: Acrophase (time-of-peak), computed from fitted sine and cosine coefficients
}


Note that because the model is parameterized with a negative phase inside the
cosine, this means the the derived peak time from acrophase corresponds to
the peak time forward from midnight (not backward). In other words, the
when the acrophase is positive, it means the peak activity time occurs after
midnight and vice versa.


\strong{Linearized form}:
     \deqn{\hat{y} = M + \beta x + \gamma z + \epsilon }
\itemize{
  \item \eqn{\beta = A * cos(\phi)}, estimated coefficient for the cosine term
  \item \eqn{x = cos(\frac{2 * \pi * t} {\tau})}, cosine-transformed time
  \item \eqn{\gamma = A * sin(\phi)}, estimated coefficient for the sine term
  \item \eqn{z = sin(\frac{2 * \pi * t} {\tau})}, sine-transformed time
  \item \eqn{\epsilon }: error term
}

Model parameters are estimated by minimizing the residual sum of squares:
\deqn{RSS = \sum_{i=1}^n (y_i - (M + \beta x_i + \gamma z_i))^2}
By default, \code{\link[stats]{lm}} fits this via QR decomposition.

\strong{Acrophase \eqn{\phi} interpretation}:
 \eqn{\phi } is derived from
 \deqn{\phi = \arctan2(\frac{\gamma} {\beta}) }

 Note,
\itemize{
  \item \eqn{\phi } can be converted to clock time to identify the peak activity time AFTER midnight.
  \item if the model is not a mono-phase (i.e., more than one \eqn{\tau }), there will be \eqn{\frac{24 (hours)} {\tau} } number of peaks within a day.
}


\strong{Amplitude \eqn{(A) } estimation}:
Amplitude is calculated from fitted sine and cosine coefficients as:
\deqn{A= \sqrt {(\beta^2 + \gamma^2)}}
}
\examples{
require (stats)
require (graphics)

\dontrun{
# Import data
data (FlyEast)


# Create quick summary of the recording with adjustment for daylight saving.
BdfList <-
    BriefSum (
        df = FlyEast,
        SR = 1 / 60,
        Start = "2017-10-24 13:45:00"
    )

# Let's extract actigraphy data from a single day
df <- BdfList$df
df <- subset (df, df$Date == "2017-10-27")

fit <- CosinorM (
    time = df$Time,
    activity = df$Activity,
    tau = 24,
    method = "OLS"
)


# inspect coefficients
fit$coef.cosinor


# plot Cosinor in hours
plot (fit$time, fit$fitted.values, type = "l", xlab = "Hour", ylab = "24-Hour Cosinor Model")
}
}
\references{
Chambers, J. M. (1992) Linear models. Chapter 4 of Statistical Models in S eds J. M. Chambers and T. J. Hastie, Wadsworth & Brooks/Cole.

Wilkinson, G. N. and Rogers, C. E. (1973). Symbolic descriptions of factorial models for analysis of variance. Applied Statistics, 22, 392-399. doi:10.2307/2346786.

Harvey, A. C. (1976). Estimating Regression Models with Multiplicative Heteroscedasticity. Econometrica, 44(3), 461-465. doi:10.2307/1913974
}
\seealso{
\code{\link[stats]{lm}}  \code{\link{CosinorM.KDE}}
}
\keyword{cosinor}
