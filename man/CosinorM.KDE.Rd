% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/CosinorM.KDE.R
\name{CosinorM.KDE}
\alias{CosinorM.KDE}
\title{KDE-based circadian cosinor summary}
\usage{
CosinorM.KDE(time, activity, bw = 0.4, grid = 360)
}
\arguments{
\item{time}{Numeric vector of event times in hours. Values are interpreted
modulo 24 and must lie in [0, 24). If not numeric, the function will
attempt to convert using C2T.}

\item{activity}{Numeric vector of non-negative weights corresponding to
each time point. If not numeric, the function will coerce to numeric.}

\item{bw}{Numeric scalar. Kernel standard deviation on the circular scale
(radians). Controls smoothing of the wrapped Gaussian kernel. Default 0.4.}

\item{grid}{Integer. Number of evaluation points for the circular KDE grid.
Default 360 (i.e., one-degree resolution on the 0..2*pi circle).}
}
\value{
A list of class c("CosinorM.KDE") with elements:
  - tau: 24 (period in hours)
  - kdf: data.frame with columns
      **theta** angular grid in radians; **density** KDE values; **hour** grid in hours
  - coef.cosinor: named numeric vector with entries
      **MESOR**, **Beta**, **Gamma**, **Amplitude**, **Acrophase.rad**, **Acrophase.hr**
}
\description{
Fit a wrapped-Gaussian kernel density estimate (KDE) on circular time
(hours of day) weighted by activity and extract cosinor summaries:
MESOR, first-harmonic coefficients (Beta, Gamma), Amplitude and Acrophase.
}
\details{
This function builds a circular KDE from event times (hours in [0,24))
and nonnegative weights (activity). The KDE is computed on a regular grid
over [0, 2*pi) using a wrapped Gaussian kernel with specified bandwidth.
Cosinor quantities are obtained by numerical integration of the KDE:
MESOR is the mean level, Beta and Gamma are the first-harmonic cosine and
sine coefficients, Amplitude is the magnitude of the first harmonic, and
Acrophase is the peak time expressed in radian and hour.


- The KDE is computed for each grid angle t_g by summing weighted Gaussian
  densities of the wrapped angular differences t_g - theta_i, where theta_i
  are the input times converted to `radian`.
- Numerical integration over the closed circular interval is performed with
  the trapezoid rule after ordering the grid and appending the first grid
  point shifted by 2*pi to close the circle.
- Cosinor integrals used:
  - I0 = ∫ f(theta) d-theta
  - Icos = ∫ f(theta) cos(theta) d-theta
  - Isin = ∫ f(theta) sin(theta) dtheta
  - MESOR = I0 / (2*pi)
  - Beta = a1 = Icos / pi
  - Gamma = b1 = Isin / pi
  - Amplitude = sqrt(a1^2 + b1^2)
  - Acrophase (radians) = atan2(-b1, a1) modulo 2*pi
  - Acrophase (hours) = Acrophase.rad * 24 / (2*pi)
}
\examples{
# simulate times (hours) and activity weights
set.seed(1)
times <- runif(200, 0, 24)
activity <- pmax(0, rnorm(200, mean = 1 + 0.5 * cos(2 * pi * times / 24 - 1), sd = 0.5))
fit <- CosinorM.KDE(times, activity)
# inspect coefficients
fit$coef.cosinor
# plot KDE in hours
plot(fit$kdf$hour, fit$kdf$density, type = "l", xlab = "Hour", ylab = "KDE")



}
\seealso{
cosinor model implementations and circular KDE methods
}
\keyword{KDE}
\keyword{circadian}
\keyword{circular}
\keyword{cosinor}
